# HMM_Anomaly_Detection_C #
 Project for IL2232 course at kth, implementing hmm anomaly detection in C

# 0. Introduction #
This project uses C to implement the anomaly detection based on HMM. Each pair of header file and c file implements the function that is specified by the name of the file. The file "macro.h" chooses the type of emission, which is further discussed in section 3. Please read this readme thoroughly before compile and test.

If the reader has interest in the detailed implementation, please refer to the code. The code is self-explained and we believe that we have provided adequate comments.

# 1. File organization #
This repo contains 
1. scripts for anomaly detection, 
2. a folder "dataset", containing specially formatted dataset, 
3. a folder "Model_Parameters", containing the parameters of HMM, 
4. a folder "obtained_statistics", containing "P.txt", which is the evaluated probability, 
5. Pre-dataset, containing four folders, each containing one dataset and a pre-calculated probability text file "P.txt", 
6. a makefile, and 
7. a folder "pre-compiled", containing two pre-compiled executable, one for discrete HMM and the other for Gaussian HMM.

# 2. Environment #
As far as we are concerned, this script should be able to run as long as there is gcc. This project is originally coded in MacOs M1 using XCode, but have been tested on Linux and Windows. Even though it has been a while since we last tested, there should not be much problem running the file on Linux or Windows.

# 3. Execution guidelines #
## How to compile ##
Use the command console, go to this directory, type "make" should execute the makefile.

__optional:__ gcc gcc -o work AnomalyDetection.c DiscreteModelFunc.c Forward.c GaussianModelFunc.c fileio.c main.c

__optional:__ in case that the compile does not work, the user could use the pre-compiled executable stored in folder "pre-compiled". Just copy the proper exe to the root folder of this project.

## How to execute ##
In this directory, type "./work". This is the same as other C projects.

## The expected result ##
The texts shown in standard console output are not important, but can be useful in some cases. The "alpha"s show the intermediate values. The "precision", "recall", and "F-score" are valid once the threshold is set in file "AnomalyDetection.c". If the threshold is not set, then these three items are not valid.

The important result is stored in the folder "obtained_statistics" => "P.txt". It saves the log likelihood for all sequences stored in the folder "dataset". The expected result is stored with each dataset in folder "Pre-dataset". By comparing the stored result with the generated text, the functionality of this project is verified.

__optional:__ compare the generated result with the Python result.

## How to change the type of emission ##
An important feature of HMM is the type of emission probability. It is either discrete or gaussian. In each dataset stored in folder "pre-dataset", the folder name indicates which type should be used. The user has to make sure that the correct type is chosen in the code __before__ compile.

To change the type, simple take a look at the file "macros.h" and change accordingly. Uncomment the proper type, and comment the others. Note that even there is GMM HMM, we have not implemented that yet, thus uncommented the GMM type will not result in anything.

# 4. Pre-dataset explanation #
There are four dataset given in folder "Pre-dataset". In the "dataset" folder for each dataset, the file "Test_anomaly_set_array.txt" stores the observation sequence. The file "Test_anomaly_set_label.txt" stores the labels for each sequence.

The four pre-datasets are:
1. hand-written-model-gaussian: this dataset is the dataset that we generated by hand. Its evaluated probability is also calculated by hand.
2. vhdl-testbench-discrete: this dataset is one of the dataset we have used to test the RTL.
3. Lympho-discrete: this is the dataset Lympho, which is a real-life dataset. It was used in the early stage of this project, but was found later that it's not good enough for demo. However, it still shows many aspects of this project, that's why we put it there. This is the only dataset where there are multiple sequences, so the reader could see that there are multiple numbers in the file "P.txt".
4. hand-written-model-discrete: this is the dataset whose result is computed by hand. If the reader is interested, he could try to calculate and check the value stored in "P.txt".
